<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>Mindful Eating Coach</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .pb-safe { padding-bottom: env(safe-area-inset-bottom, 20px); }
        input, textarea, select { font-size: 16px !important; }
        button { min-height: 44px; }
        html { scroll-behavior: smooth; }
        .overflow-y-auto::-webkit-scrollbar { width: 4px; }
        .overflow-y-auto::-webkit-scrollbar-track { background: transparent; }
        .overflow-y-auto::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 2px; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        // Simple icon replacements
        const Bell = ({ className }) => React.createElement('span', { className }, 'ðŸ””');
        const Heart = ({ className }) => React.createElement('span', { className }, 'â¤ï¸');
        const Clock = ({ className }) => React.createElement('span', { className }, 'â°');
        const CheckCircle = ({ className }) => React.createElement('span', { className }, 'âœ…');
        const AlertCircle = ({ className }) => React.createElement('span', { className }, 'âš ï¸');
        const Lightbulb = ({ className }) => React.createElement('span', { className }, 'ðŸ’¡');
        const Home = ({ className }) => React.createElement('span', { className }, 'ðŸ ');
        const Menu = ({ className }) => React.createElement('span', { className }, 'â˜°');
        const X = ({ className }) => React.createElement('span', { className }, 'âœ•');
        const BarChart = ({ className }) => React.createElement('span', { className }, 'ðŸ“Š');

        const MindfulEatingCoach = () => {
            const [currentView, setCurrentView] = React.useState('home');
            const [hungerLevel, setHungerLevel] = React.useState(null);
            const [notifications, setNotifications] = React.useState([]);
            const [isEating, setIsEating] = React.useState(false);
            const [eatingStartTime, setEatingStartTime] = React.useState(null);
            const [currentQuestion, setCurrentQuestion] = React.useState(0);
            const [eatingResponses, setEatingResponses] = React.useState([]);
            const [currentResponse, setCurrentResponse] = React.useState('');
            const [eatingNote, setEatingNote] = React.useState('');
            const [cravingLog, setCravingLog] = React.useState([]);
            const [currentCravingData, setCurrentCravingData] = React.useState({
                timestamp: null,
                food: '',
                emotions: [],
                intensity: null,
                triggers: [],
                outcome: ''
            });
            const [isMenuOpen, setIsMenuOpen] = React.useState(false);

            // Load data from localStorage on startup
            React.useEffect(() => {
                const savedCravingLog = localStorage.getItem('mindfulEating_cravingLog');
                if (savedCravingLog) {
                    setCravingLog(JSON.parse(savedCravingLog));
                }
            }, []);

            // Save craving log to localStorage whenever it changes
            React.useEffect(() => {
                localStorage.setItem('mindfulEating_cravingLog', JSON.stringify(cravingLog));
            }, [cravingLog]);

            // Request notification permission
            React.useEffect(() => {
                if ('Notification' in window) {
                    Notification.requestPermission();
                }
            }, []);

            // Data arrays
            const distractionActivities = [
                "Meditate for 90 seconds",
                "Drink a glass of water",
                "Go for a 2-minute walk",
                "Listen to your favorite song",
                "Take 5 deep breaths",
                "Text a friend",
                "Write down 5 things you can see",
                "Do a quick stretch",
                "Look out the window",
                "Practice gratitude - think of 3 things you're thankful for",
                "Organize your desk or a small space",
                "Take a few photos of something beautiful nearby"
            ];

            const mindfulEatingPrompts = [
                {
                    text: "Take a moment to look at your food. Notice the colors, textures, and presentation.",
                    responseType: "observation",
                    placeholder: "What do you notice about your food?"
                },
                {
                    text: "Take your first bite slowly. Chew thoroughly and notice the flavors.",
                    responseType: "taste",
                    placeholder: "How does it taste? What flavors do you notice?"
                },
                {
                    text: "Put your utensils down until you are done chewing. How are you feeling?",
                    responseType: "feeling",
                    placeholder: "How are you feeling right now?"
                },
                {
                    text: "Check in with your hunger level now. Are you still hungry?",
                    responseType: "hunger",
                    options: ["Very hungry", "Moderately hungry", "Slightly hungry", "Not hungry", "Getting full"]
                },
                {
                    text: "Notice how your body feels. Are you getting less hungry?",
                    responseType: "satisfaction",
                    options: ["Still very hungry", "Still hungry", "Starting to feel satisfied", "Feeling satisfied", "Getting full"]
                },
                {
                    text: "Take a sip of water. How does your body feel now?",
                    responseType: "body",
                    placeholder: "How does your body feel after the water?"
                },
                {
                    text: "You're doing great! Keep eating slowly and mindfully.",
                    responseType: "reflection",
                    placeholder: "How is this mindful eating experience going for you?"
                },
                {
                    text: "Final check: How satisfied do you feel right now?",
                    responseType: "final",
                    options: ["Still hungry", "Slightly satisfied", "Comfortably satisfied", "Very satisfied", "Too full"]
                }
            ];

            const cravingQuestions = [
                {
                    question: "What are you craving specifically?",
                    type: "food",
                    options: ["Something sweet (candy, dessert)", "Something salty/crunchy (chips, crackers)", "Something creamy/rich (ice cream, cheese)", "Comfort food (pizza, pasta)", "A full meal", "Other"],
                    insight: "Specific cravings often reveal emotional needs rather than hunger."
                },
                {
                    question: "How intense is this craving right now?",
                    type: "intensity", 
                    options: ["1 - Mild", "2 - Moderate", "3 - Strong", "4 - Very strong", "5 - Overwhelming"],
                    insight: "Intense cravings are more likely to be emotional rather than physical."
                },
                {
                    question: "What emotions are you feeling right now? (Select all that apply)",
                    type: "emotions",
                    multiSelect: true,
                    options: ["Stressed", "Anxious", "Bored", "Sad", "Lonely", "Tired", "Angry", "Angry", "Excited", "Distracted", "Overwhelmed", "Neutral"],
                    insight: "Identifying emotions helps recognize patterns in emotional eating."
                },
                {
                    question: "When did you last eat a full meal?",
                    type: "timing",
                    options: ["Less than 2 hours ago", "2-4 hours ago", "4-6 hours ago", "More than 6 hours ago"],
                    insight: "If it's been more than 4 hours, this might be real hunger!"
                },
                {
                    question: "What might have triggered this craving? (Select all that apply)",
                    type: "triggers",
                    multiSelect: true,
                    options: ["Saw or smelled food/ad", "Work stress/issue", "Relationship stress", "Fatigue", "Habit/routine", "Social situation", "Physical discomfort", "Nothing specific"],
                    insight: "Understanding triggers helps you prepare for and manage future cravings."
                }
            ];

            // Helper functions
            const scheduleReminder = (minutes, message) => {
                if ('Notification' in window && Notification.permission === 'granted') {
                    setTimeout(() => {
                        new Notification('Mindful Eating Coach', {
                            body: message,
                            icon: 'ðŸ½ï¸'
                        });
                    }, minutes * 60 * 1000);
                }
            };

            const getRandomActivities = () => {
                return distractionActivities
                    .sort(() => Math.random() - 0.5)
                    .slice(0, 4);
            };

            const getTimeOfDay = (date) => {
                const hour = date.getHours();
                if (hour < 6) return 'Late Night';
                if (hour < 12) return 'Morning';
                if (hour < 17) return 'Afternoon';
                if (hour < 21) return 'Evening';
                return 'Night';
            };

            const getCravingsByTimeOfDay = () => {
                const timeGroups = {};
                cravingLog.forEach(entry => {
                    const timeOfDay = getTimeOfDay(new Date(entry.timestamp));
                    if (!timeGroups[timeOfDay]) {
                        timeGroups[timeOfDay] = [];
                    }
                    timeGroups[timeOfDay].push(entry);
                });
                return timeGroups;
            };

            const getIntensityDistribution = () => {
                const distribution = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };
                cravingLog.forEach(entry => {
                    const intensity = parseInt(entry.intensity?.charAt(0)) || 0;
                    if (intensity >= 1 && intensity <= 5) {
                        distribution[intensity]++;
                    }
                });
                return distribution;
            };

            // Action handlers
            const handleHungerCheck = (level) => {
                setHungerLevel(level);
                if (level <= 2) {
                    setCurrentView('wait');
                    scheduleReminder(60, "Time to check your hunger level again!");
                    setTimeout(() => {
                        setCurrentView('home');
                        setHungerLevel(null);
                    }, 5000);
                } else {
                    setCurrentView('readyToEat');
                }
            };

            const startEating = () => {
                setIsEating(true);
                setEatingStartTime(Date.now());
                setCurrentView('eating');
                setCurrentQuestion(0);
                setEatingResponses([]);
                setCurrentResponse('');
            };

            const nextEatingPrompt = () => {
                if (currentResponse.trim() || eatingResponses[currentQuestion]) {
                    const newResponses = [...eatingResponses];
                    newResponses[currentQuestion] = currentResponse || eatingResponses[currentQuestion];
                    setEatingResponses(newResponses);
                }
                
                setCurrentResponse('');
                
                if (currentQuestion < mindfulEatingPrompts.length - 1) {
                    setCurrentQuestion(currentQuestion + 1);
                } else {
                    setCurrentView('eatingComplete');
                }
            };

            const previousEatingPrompt = () => {
                if (currentQuestion > 0) {
                    setCurrentQuestion(currentQuestion - 1);
                    setCurrentResponse(eatingResponses[currentQuestion - 1] || '');
                }
            };

            const handleResponseSelect = (response) => {
                setCurrentResponse(response);
                const newResponses = [...eatingResponses];
                newResponses[currentQuestion] = response;
                setEatingResponses(newResponses);
            };

            const startCravingCheck = () => {
                setCurrentView('cravingCheck');
                setCurrentQuestion(0);
                setCurrentCravingData({
                    timestamp: new Date(),
                    food: '',
                    emotions: [],
                    intensity: null,
                    triggers: [],
                    outcome: ''
                });
            };

            const nextCravingQuestion = (selectedOption = null) => {
                if (selectedOption) {
                    const questionType = cravingQuestions[currentQuestion].type;
                    const updatedData = { ...currentCravingData };
                    
                    if (cravingQuestions[currentQuestion].multiSelect) {
                        if (!updatedData[questionType].includes(selectedOption)) {
                            updatedData[questionType] = [...updatedData[questionType], selectedOption];
                        }
                    } else {
                        updatedData[questionType] = selectedOption;
                    }
                    
                    setCurrentCravingData(updatedData);
                }
                
                if (currentQuestion < cravingQuestions.length - 1) {
                    setCurrentQuestion(currentQuestion + 1);
                } else {
                    setCurrentView('cravingResult');
                }
            };

            const previousCravingQuestion = () => {
                if (currentQuestion > 0) {
                    setCurrentQuestion(currentQuestion - 1);
                } else {
                    setCurrentView('home');
                }
            };

            // Component renders
            const renderHeader = () => (
                React.createElement('div', { className: 'sticky top-0 bg-white border-b border-gray-200 px-4 py-3 flex items-center justify-between z-10' },
                    React.createElement('button', {
                        onClick: () => setCurrentView('home'),
                        className: 'p-2 text-gray-600 hover:text-gray-800'
                    }, React.createElement(Home, { className: 'w-6 h-6' })),
                    
                    React.createElement('h1', { className: 'text-lg font-semibold text-gray-800 truncate mx-4' },
                        currentView === 'home' ? 'Mindful Eating Coach' :
                        currentView === 'hungerCheck' ? 'Hunger Check' :
                        currentView === 'eating' ? 'Mindful Eating' :
                        currentView === 'cravingCheck' ? 'Craving Assessment' :
                        currentView === 'cravingResult' ? 'Craving Analysis' :
                        currentView === 'cravingAnalytics' ? 'Your Patterns' :
                        currentView === 'cravingTracking' ? 'Craving Tracker' :
                        currentView === 'eatingComplete' ? 'Session Complete' : 'Mindful Eating Coach'
                    ),
                    
                    React.createElement('button', {
                        onClick: () => setIsMenuOpen(!isMenuOpen),
                        className: 'p-2 text-gray-600 hover:text-gray-800'
                    }, isMenuOpen ? React.createElement(X, { className: 'w-6 h-6' }) : React.createElement(Menu, { className: 'w-6 h-6' }))
                )
            );

            const renderMenu = () => (
                React.createElement('div', { 
                    className: `fixed inset-0 bg-black bg-opacity-50 z-20 ${isMenuOpen ? 'block' : 'hidden'}`,
                    onClick: () => setIsMenuOpen(false)
                },
                    React.createElement('div', { 
                        className: 'fixed right-0 top-0 h-full w-64 bg-white shadow-lg p-4',
                        onClick: (e) => e.stopPropagation()
                    },
                        React.createElement('div', { className: 'space-y-4 mt-16' },
                            React.createElement('button', {
                                onClick: () => {
                                    setCurrentView('cravingTracking');
                                    setIsMenuOpen(false);
                                },
                                className: 'w-full text-left p-3 rounded-lg hover:bg-gray-100 flex items-center'
                            },
                                React.createElement(BarChart, { className: 'w-5 h-5 mr-3 text-blue-500' }),
                                'Craving Tracker'
                            ),

                            React.createElement('button', {
                                onClick: () => {
                                    setCurrentView('cravingAnalytics');
                                    setIsMenuOpen(false);
                                },
                                className: 'w-full text-left p-3 rounded-lg hover:bg-gray-100 flex items-center'
                            },
                                React.createElement(AlertCircle, { className: 'w-5 h-5 mr-3 text-purple-500' }),
                                'View Patterns'
                            ),
                            
                            React.createElement('div', { className: 'pt-4 border-t border-gray-200' },
                                React.createElement('p', { className: 'text-sm text-gray-500 mb-2' }, 'Notifications'),
                                React.createElement('button', {
                                    onClick: () => {
                                        if ('Notification' in window) {
                                            Notification.requestPermission();
                                        }
                                    },
                                    className: 'w-full text-left p-3 rounded-lg hover:bg-gray-100 text-sm'
                                }, 'Enable Reminders')
                            )
                        )
                    )
                )
            );

            const renderHome = () => (
                React.createElement('div', { className: 'px-4 pb-6 space-y-6' },
                    React.createElement('div', { className: 'text-center py-8' },
                        React.createElement(Heart, { className: 'w-16 h-16 mx-auto text-green-500 mb-4' }),
                        React.createElement('p', { className: 'text-gray-600 text-lg' }, 'Your companion for healthy eating habits')
                    ),

                    React.createElement('div', { className: 'space-y-4' },
                        React.createElement('button', {
                            onClick: () => setCurrentView('hungerCheck'),
                            className: 'w-full bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-colors flex items-center justify-center'
                        },
                            React.createElement(Clock, { className: 'w-6 h-6 mr-3' }),
                            'Check My Hunger Level'
                        ),

                        React.createElement('button', {
                            onClick: startCravingCheck,
                            className: 'w-full bg-orange-500 hover:bg-orange-600 active:bg-orange-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-colors flex items-center justify-center'
                        },
                            React.createElement(AlertCircle, { className: 'w-6 h-6 mr-3' }),
                            "I'm Having a Craving"
                        ),

                        React.createElement('button', {
                            onClick: () => setCurrentView('cravingTracking'),
                            className: 'w-full bg-indigo-500 hover:bg-indigo-600 active:bg-indigo-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-colors flex items-center justify-center'
                        },
                            React.createElement(BarChart, { className: 'w-6 h-6 mr-3' }),
                            'Track Cravings'
                        )
                    ),

                    cravingLog.length > 0 && React.createElement('div', { className: 'bg-purple-50 border border-purple-200 rounded-xl p-4' },
                        React.createElement('h3', { className: 'font-semibold text-purple-800 mb-2' }, 'Quick Stats'),
                        React.createElement('div', { className: 'text-sm text-purple-700' },
                            React.createElement('p', null, `Total cravings tracked: ${cravingLog.length}`),
                            React.createElement('p', null, `This week: ${cravingLog.filter(entry => {
                                const weekAgo = new Date();
                                weekAgo.setDate(weekAgo.getDate() - 7);
                                return new Date(entry.timestamp) > weekAgo;
                            }).length}`)
                        )
                    )
                )
            );

            const renderHungerCheck = () => (
                React.createElement('div', { className: 'px-4 pb-6 space-y-6' },
                    React.createElement('div', { className: 'text-center py-4' },
                        React.createElement('h2', { className: 'text-xl font-bold text-gray-800 mb-2' }, 'How hungry are you right now?'),
                        React.createElement('p', { className: 'text-gray-600' }, 'Rate your hunger on a scale of 1-7')
                    ),
                    
                    React.createElement('div', { className: 'space-y-3' },
                        [1, 2, 3, 4, 5, 6, 7].map(level => (
                            React.createElement('button', {
                                key: level,
                                onClick: () => handleHungerCheck(level),
                                className: `w-full p-4 rounded-xl border-2 transition-all active:scale-95 ${
                                    level <= 2 ? 'border-red-200 hover:bg-red-50 active:bg-red-100' :
                                    level <= 4 ? 'border-yellow-200 hover:bg-yellow-50 active:bg-yellow-100' :
                                    'border-green-200 hover:bg-green-50 active:bg-green-100'
                                }`
                            },
                                React.createElement('div', { className: 'flex items-center justify-between' },
                                    React.createElement('span', { className: 'font-bold text-xl' }, level),
                                    React.createElement('span', { className: 'text-sm text-gray-600 text-right' },
                                        level === 1 ? "Not hungry at all" :
                                        level === 2 ? "Slightly hungry" :
                                        level === 3 ? "Moderately hungry" :
                                        level === 4 ? "Hungry" :
                                        level === 5 ? "Very hungry" :
                                        level === 6 ? "Extremely hungry" :
                                        level === 7 ? "Starving" : ""
                                    )
                                )
                            )
                        ))
                    )
                )
            );

            const renderWait = () => (
                React.createElement('div', { className: 'px-4 pb-6 text-center space-y-6' },
                    React.createElement('div', { className: 'py-8' },
                        React.createElement(Clock, { className: 'w-16 h-16 mx-auto text-blue-500 mb-4' }),
                        React.createElement('h2', { className: 'text-xl font-bold text-gray-800 mb-4' }, 'Not quite hungry yet!'),
                        React.createElement('p', { className: 'text-gray-600' },
                            `Since you're at a ${hungerLevel} on the hunger scale, let's wait a bit longer. I'll remind you to check again in an hour.`
                        )
                    ),
                    React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-xl p-4' },
                        React.createElement('p', { className: 'text-blue-800 text-sm' },
                            'ðŸŽ‰ Great job! You\'re learning to recognize true hunger signals.'
                        )
                    )
                )
            );

            const renderReadyToEat = () => (
                React.createElement('div', { className: 'px-4 pb-6 text-center space-y-6' },
                    React.createElement('div', { className: 'py-8' },
                        React.createElement(CheckCircle, { className: 'w-16 h-16 mx-auto text-green-500 mb-4' }),
                        React.createElement('h2', { className: 'text-xl font-bold text-gray-800 mb-4' }, 'You\'re hungry!'),
                        React.createElement('p', { className: 'text-gray-600' },
                            `Your hunger level is ${hungerLevel}. Are you ready to eat now?`
                        )
                    ),
                    
                    React.createElement('div', { className: 'space-y-4' },
                        React.createElement('button', {
                            onClick: startEating,
                            className: 'w-full bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all active:scale-95'
                        }, 'Yes, I\'m ready to eat'),
                        
                        React.createElement('button', {
                            onClick: () => {
                                setCurrentView('waitShort');
                                scheduleReminder(30, "Ready to eat now?");
                                setTimeout(() => {
                                    setCurrentView('home');
                                    setHungerLevel(null);
                                }, 3000);
                            },
                            className: 'w-full bg-gray-500 hover:bg-gray-600 active:bg-gray-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all active:scale-95'
                        }, 'Not yet, remind me in 30 minutes')
                    )
                )
            );

            const renderWaitShort = () => (
                React.createElement('div', { className: 'px-4 pb-6 text-center space-y-6' },
                    React.createElement('div', { className: 'py-8' },
                        React.createElement(Clock, { className: 'w-16 h-16 mx-auto text-blue-500 mb-4' }),
                        React.createElement('h2', { className: 'text-xl font-bold text-gray-800 mb-4' }, 'See you in 30 minutes!'),
                        React.createElement('p', { className: 'text-gray-600' },
                            'I\'ll send you a reminder in 30 minutes to see if you\'re ready to eat.'
                        )
                    )
                )
            );

            const renderEating = () => (
                React.createElement('div', { className: 'px-4 pb-6 space-y-6' },
                    React.createElement('div', { className: 'text-center py-4' },
                        React.createElement('div', { className: 'w-12 h-12 mx-auto bg-green-500 rounded-full flex items-center justify-center mb-4' },
                            React.createElement(Heart, { className: 'w-6 h-6 text-white' })
                        ),
                        React.createElement('p', { className: 'text-sm text-gray-500' },
                            `Step ${currentQuestion + 1} of ${mindfulEatingPrompts.length}`
                        ),
                        React.createElement('div', { className: 'w-full bg-gray-200 rounded-full h-2 mt-2' },
                            React.createElement('div', { 
                                className: 'bg-green-500 h-2 rounded-full transition-all duration-300',
                                style: { width: `${((currentQuestion + 1) / mindfulEatingPrompts.length) * 100}%` }
                            })
                        )
                    ),

                    React.createElement('div', { className: 'bg-green-50 border border-green-200 rounded-xl p-6' },
                        React.createElement('p', { className: 'text-green-800 text-lg leading-relaxed mb-4' },
                            mindfulEatingPrompts[currentQuestion].text
                        ),
                        
                        mindfulEatingPrompts[currentQuestion].options && React.createElement('div', { className: 'space-y-3' },
                            mindfulEatingPrompts[currentQuestion].options.map((option, index) => (
                                React.createElement('button', {
                                    key: index,
                                    onClick: () => handleResponseSelect(option),
                                    className: `w-full p-3 text-left rounded-lg border-2 transition-all active:scale-95 ${
                                        currentResponse === option || eatingResponses[currentQuestion] === option
                                            ? 'border-green-500 bg-green-100 text-green-800'
                                            : 'border-green-200 bg-white hover:bg-green-50'
                                    }`
                                }, option)
                            ))
                        ),
                        
                        mindfulEatingPrompts[currentQuestion].placeholder && React.createElement('div', { className: 'mt-4' },
                            React.createElement('textarea', {
                                value: currentResponse,
                                onChange: (e) => setCurrentResponse(e.target.value),
                                placeholder: mindfulEatingPrompts[currentQuestion].placeholder,
                                className: 'w-full p-3 border border-green-200 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-base',
                                rows: 3
                            })
                        )
                    ),

                    React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                        React.createElement('button', {
                            onClick: previousEatingPrompt,
                            disabled: currentQuestion === 0,
                            className: `font-semibold py-3 px-6 rounded-xl shadow-lg transition-all ${
                                currentQuestion === 0 
                                    ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                    : 'bg-gray-500 hover:bg-gray-600 active:bg-gray-700 text-white active:scale-95'
                            }`
                        }, 'Back'),
                        
                        React.createElement('button', {
                            onClick: nextEatingPrompt,
                            className: 'bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-semibold py-3 px-6 rounded-xl shadow-lg transition-all active:scale-95'
                        }, currentQuestion < mindfulEatingPrompts.length - 1 ? 'Next' : 'Finish')
                    ),
                    
                    React.createElement('button', {
                        onClick: () => setCurrentView('eatingComplete'),
                        className: 'w-full text-gray-500 hover:text-gray-700 transition-colors text-sm py-2'
                    }, 'I\'m done eating now')
                )
            );

            const renderEatingComplete = () => (
                React.createElement('div', { className: 'px-4 pb-6 space-y-6' },
                    React.createElement('div', { className: 'text-center py-4' },
                        React.createElement(CheckCircle, { className: 'w-16 h-16 mx-auto text-green-500 mb-4' }),
                        React.createElement('h2', { className: 'text-xl font-bold text-gray-800' }, 'How was your eating experience?')
                    ),
                    
                    React.createElement('div', { className: 'bg-green-50 border border-green-200 rounded-xl p-6' },
                        React.createElement('p', { className: 'text-green-800 text-lg mb-4' },
                            'Take a moment to reflect on your mindful eating session.'
                        ),
                        
                        React.createElement('textarea', {
                            value: eatingNote,
                            onChange: (e) => setEatingNote(e.target.value),
                            placeholder: "How did this eating experience feel? What did you notice about your hunger, satisfaction, or the food itself? Any insights or observations?",
                            className: 'w-full p-4 border border-green-200 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-left text-base',
                            rows: 4
                        })
                    ),

                    eatingResponses.length > 0 && React.createElement('div', { className: 'bg-white border border-green-200 rounded-xl p-4' },
                        React.createElement('h3', { className: 'font-semibold text-green-800 mb-3' }, 'Your Session Summary:'),
                        React.createElement('div', { className: 'space-y-2 text-left text-sm max-h-40 overflow-y-auto' },
                            eatingResponses.map((response, index) => (
                                response && React.createElement('div', { key: index, className: 'p-2 bg-green-50 rounded' },
                                    React.createElement('span', { className: 'text-gray-600 capitalize' }, `${mindfulEatingPrompts[index]?.responseType}: `),
                                    React.createElement('span', { className: 'ml-2 text-green-800' }, response)
                                )
                            ))
                        )
                    ),

                    React.createElement('button', {
                        onClick: () => {
                            setCurrentView('home');
                            setIsEating(false);
                            setEatingStartTime(null);
                            setEatingResponses([]);
                            setCurrentResponse('');
                            setCurrentQuestion(0);
                            setEatingNote('');
                        },
                        className: 'w-full bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all active:scale-95'
                    }, 'Save & Return to Home')
                )
            );

            const renderCravingCheck = () => (
                React.createElement('div', { className: 'px-4 pb-6 space-y-6' },
                    React.createElement('div', { className: 'text-center py-4' },
                        React.createElement(AlertCircle, { className: 'w-12 h-12 mx-auto text-orange-500 mb-4' }),
                        React.createElement('p', { className: 'text-sm text-gray-500' },
                            `Question ${currentQuestion + 1} of ${cravingQuestions.length}`
                        ),
                        React.createElement('div', { className: 'w-full bg-gray-200 rounded-full h-2 mt-2' },
                            React.createElement('div', { 
                                className: 'bg-orange-500 h-2 rounded-full transition-all duration-300',
                                style: { width: `${((currentQuestion + 1) / cravingQuestions.length) * 100}%` }
                            })
                        )
                    ),

                    React.createElement('div', { className: 'bg-orange-50 border border-orange-200 rounded-xl p-6' },
                        React.createElement('p', { className: 'text-orange-800 text-lg font-semibold mb-4' },
                            cravingQuestions[currentQuestion].question
                        ),
                        
                        React.createElement('div', { className: 'space-y-3' },
                            cravingQuestions[currentQuestion].options.map((option, index) => {
                                const isSelected = cravingQuestions[currentQuestion].multiSelect 
                                    ? currentCravingData[cravingQuestions[currentQuestion].type]?.includes(option)
                                    : currentCravingData[cravingQuestions[currentQuestion].type] === option;
                                    
                                return React.createElement('button', {
                                    key: index,
                                    onClick: () => nextCravingQuestion(option),
                                    className: `w-full p-3 text-left rounded-lg border-2 transition-all active:scale-95 ${
                                        isSelected
                                            ? 'border-orange-500 bg-orange-100 text-orange-800'
                                            : 'bg-white hover:bg-orange-100 border-orange-200'
                                    }`
                                },
                                    React.createElement('div', { className: 'flex items-center justify-between' },
                                        React.createElement('span', { className: 'text-sm' }, option),
                                        isSelected && React.createElement('span', { className: 'text-orange-600 font-bold' }, 'âœ“')
                                    )
                                );
                            })
                        ),
                        
                        cravingQuestions[currentQuestion].multiSelect && React.createElement('div', { className: 'mt-4' },
                            React.createElement('button', {
                                onClick: () => nextCravingQuestion(),
                                className: 'w-full bg-orange-500 hover:bg-orange-600 active:bg-orange-700 text-white font-semibold py-3 px-6 rounded-xl shadow-lg transition-all active:scale-95'
                            }, 'Continue')
                        )
                    ),

                    React.createElement('div', { className: 'bg-gray-50 border border-gray-200 rounded-xl p-3' },
                        React.createElement('p', { className: 'text-sm text-gray-600' },
                            `ðŸ’¡ ${cravingQuestions[currentQuestion].insight}`
                        )
                    ),

                    React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                        React.createElement('button', {
                            onClick: previousCravingQuestion,
                            className: 'bg-gray-500 hover:bg-gray-600 active:bg-gray-700 text-white font-semibold py-3 px-6 rounded-xl shadow-lg transition-all active:scale-95'
                        }, currentQuestion > 0 ? 'Back' : 'Cancel'),
                        
                        React.createElement('button', {
                            onClick: () => {
                                const newCravingEntry = {
                                    ...currentCravingData,
                                    outcome: 'completed_assessment'
                                };
                                setCravingLog(prev => [...prev, newCravingEntry]);
                                setCurrentView('cravingResult');
                            },
                            className: 'bg-orange-500 hover:bg-orange-600 active:bg-orange-700 text-white font-semibold py-3 px-6 rounded-xl shadow-lg transition-all active:scale-95'
                        }, 'Skip to Results')
                    )
                )
            );

            const renderCravingResult = () => {
                const logCraving = (outcome) => {
                    const newCravingEntry = {
                        ...currentCravingData,
                        outcome: outcome
                    };
                    setCravingLog(prev => [...prev, newCravingEntry]);
                };

                return React.createElement('div', { className: 'px-4 pb-6 space-y-6' },
                    React.createElement('div', { className: 'text-center py-4' },
                        React.createElement(Lightbulb, { className: 'w-16 h-16 mx-auto text-yellow-500 mb-4' }),
                        React.createElement('h2', { className: 'text-xl font-bold text-gray-800' }, 'Craving Analysis')
                    ),
                    
                    React.createElement('div', { className: 'bg-yellow-50 border border-yellow-200 rounded-xl p-6' },
                        React.createElement('p', { className: 'text-yellow-800 text-lg font-semibold mb-4' }, 'Your Craving Profile:'),
                        React.createElement('div', { className: 'space-y-2 text-sm' },
                            React.createElement('p', null, React.createElement('strong', null, 'Craving: '), currentCravingData.food),
                            React.createElement('p', null, React.createElement('strong', null, 'Intensity: '), currentCravingData.intensity),
                            React.createElement('p', null, React.createElement('strong', null, 'Emotions: '), currentCravingData.emotions?.join(', ') || 'None selected'),
                            React.createElement('p', null, React.createElement('strong', null, 'Triggers: '), currentCravingData.triggers?.join(', ') || 'None selected'),
                            React.createElement('p', null, React.createElement('strong', null, 'Last meal: '), currentCravingData.timing)
                        )
                    ),

                    React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-xl p-4' },
                        React.createElement('p', { className: 'text-blue-800 text-sm' },
                            'Based on your responses, this seems like it might be emotional eating rather than true hunger. Try one of these activities instead!'
                        )
                    ),

                    React.createElement('div', { className: 'space-y-3' },
                        React.createElement('h3', { className: 'font-semibold text-gray-700' }, 'Try one of these instead:'),
                        getRandomActivities().map((activity, index) => (
                            React.createElement('div', { key: index, className: 'bg-white border border-gray-200 rounded-lg p-3 flex items-center' },
                                React.createElement('span', { className: 'text-green-600 mr-3 font-bold' }, 'âœ“'),
                                React.createElement('span', { className: 'text-sm' }, activity)
                            )
                        ))
                    ),

                    React.createElement('div', { className: 'space-y-3' },
                        React.createElement('button', {
                            onClick: () => {
                                logCraving('tried_distraction');
                                setCurrentView('home');
                            },
                            className: 'w-full bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all active:scale-95'
                        }, 'I\'ll try these activities'),
                        
                        React.createElement('button', {
                            onClick: () => {
                                logCraving('chose_to_eat');
                                setCurrentView('hungerCheck');
                            },
                            className: 'w-full bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all active:scale-95'
                        }, 'Actually, let me check my hunger level')
                    )
                );
            };

            // New enhanced craving tracking view
            const renderCravingTracking = () => {
                const timeGroups = getCravingsByTimeOfDay();
                const intensityDist = getIntensityDistribution();
                const totalCravings = cravingLog.length;

                // Get most common triggers
                const triggerCounts = {};
                cravingLog.forEach(entry => {
                    entry.triggers?.forEach(trigger => {
                        triggerCounts[trigger] = (triggerCounts[trigger] || 0) + 1;
                    });
                });
                const topTriggers = Object.entries(triggerCounts)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5);

                return React.createElement('div', { className: 'px-4 pb-6 space-y-6' },
                    React.createElement('div', { className: 'text-center py-4' },
                        React.createElement(BarChart, { className: 'w-16 h-16 mx-auto text-indigo-500 mb-4' }),
                        React.createElement('h2', { className: 'text-xl font-bold text-gray-800' }, 'Craving Tracker'),
                        React.createElement('p', { className: 'text-gray-600' }, 'Discover your patterns')
                    ),

                    // Time of Day Analysis
                    React.createElement('div', { className: 'bg-white border border-gray-200 rounded-xl p-6' },
                        React.createElement('h3', { className: 'font-semibold text-gray-800 mb-4' }, 'â° Time of Day Patterns'),
                        totalCravings > 0 ? React.createElement('div', { className: 'space-y-3' },
                            ['Morning', 'Afternoon', 'Evening', 'Night', 'Late Night'].map(timeOfDay => {
                                const count = timeGroups[timeOfDay]?.length || 0;
                                const percentage = totalCravings > 0 ? Math.round((count / totalCravings) * 100) : 0;
                                return React.createElement('div', { key: timeOfDay, className: 'flex items-center justify-between' },
                                    React.createElement('span', { className: 'text-sm font-medium text-gray-700' }, timeOfDay),
                                    React.createElement('div', { className: 'flex items-center' },
                                        React.createElement('div', { className: 'w-24 h-2 bg-gray-200 rounded-full mr-2' },
                                            React.createElement('div', { 
                                                className: 'h-2 bg-indigo-500 rounded-full',
                                                style: { width: `${percentage}%` }
                                            })
                                        ),
                                        React.createElement('span', { className: 'text-xs text-gray-500 w-8' }, `${count}`)
                                    )
                                );
                            })
                        ) : React.createElement('p', { className: 'text-gray-500 text-sm' }, 'No data yet. Start tracking your cravings!')
                    ),

                    // Intensity Distribution
                    React.createElement('div', { className: 'bg-white border border-gray-200 rounded-xl p-6' },
                        React.createElement('h3', { className: 'font-semibold text-gray-800 mb-4' }, 'ðŸ“Š Intensity Levels'),
                        totalCravings > 0 ? React.createElement('div', { className: 'space-y-3' },
                            [1, 2, 3, 4, 5].map(intensity => {
                                const count = intensityDist[intensity];
                                const percentage = totalCravings > 0 ? Math.round((count / totalCravings) * 100) : 0;
                                const labels = ['Mild', 'Moderate', 'Strong', 'Very Strong', 'Overwhelming'];
                                return React.createElement('div', { key: intensity, className: 'flex items-center justify-between' },
                                    React.createElement('span', { className: 'text-sm font-medium text-gray-700' }, `${intensity} - ${labels[intensity-1]}`),
                                    React.createElement('div', { className: 'flex items-center' },
                                        React.createElement('div', { className: 'w-24 h-2 bg-gray-200 rounded-full mr-2' },
                                            React.createElement('div', { 
                                                className: `h-2 rounded-full ${
                                                    intensity <= 2 ? 'bg-green-500' :
                                                    intensity <= 3 ? 'bg-yellow-500' :
                                                    'bg-red-500'
                                                }`,
                                                style: { width: `${percentage}%` }
                                            })
                                        ),
                                        React.createElement('span', { className: 'text-xs text-gray-500 w-8' }, `${count}`)
                                    )
                                );
                            })
                        ) : React.createElement('p', { className: 'text-gray-500 text-sm' }, 'No intensity data yet.')
                    ),

                    // Top Triggers
                    React.createElement('div', { className: 'bg-white border border-gray-200 rounded-xl p-6' },
                        React.createElement('h3', { className: 'font-semibold text-gray-800 mb-4' }, 'ðŸŽ¯ Most Common Triggers'),
                        topTriggers.length > 0 ? React.createElement('div', { className: 'space-y-3' },
                            topTriggers.map(([trigger, count]) => {
                                const percentage = totalCravings > 0 ? Math.round((count / totalCravings) * 100) : 0;
                                return React.createElement('div', { key: trigger, className: 'flex items-center justify-between' },
                                    React.createElement('span', { className: 'text-sm font-medium text-gray-700' }, trigger),
                                    React.createElement('div', { className: 'flex items-center' },
                                        React.createElement('div', { className: 'w-24 h-2 bg-gray-200 rounded-full mr-2' },
                                            React.createElement('div', { 
                                                className: 'h-2 bg-orange-500 rounded-full',
                                                style: { width: `${percentage}%` }
                                            })
                                        ),
                                        React.createElement('span', { className: 'text-xs text-gray-500 w-8' }, `${count}`)
                                    )
                                );
                            })
                        ) : React.createElement('p', { className: 'text-gray-500 text-sm' }, 'No trigger data yet.')
                    ),

                    // Recent Activity
                    React.createElement('div', { className: 'bg-white border border-gray-200 rounded-xl p-6' },
                        React.createElement('h3', { className: 'font-semibold text-gray-800 mb-4' }, 'ðŸ“ Recent Cravings'),
                        cravingLog.length > 0 ? React.createElement('div', { className: 'space-y-3 max-h-60 overflow-y-auto' },
                            cravingLog.slice(-10).reverse().map((entry, index) => {
                                const date = new Date(entry.timestamp);
                                const timeOfDay = getTimeOfDay(date);
                                const intensity = parseInt(entry.intensity?.charAt(0)) || 0;
                                
                                return React.createElement('div', { key: index, className: 'bg-gray-50 rounded-lg p-3 border border-gray-100' },
                                    React.createElement('div', { className: 'flex justify-between items-start mb-2' },
                                        React.createElement('div', { className: 'flex-1' },
                                            React.createElement('p', { className: 'font-medium text-gray-800 text-sm' }, entry.food),
                                            React.createElement('p', { className: 'text-xs text-gray-500' },
                                                `${date.toLocaleDateString()} â€¢ ${timeOfDay} â€¢ Intensity: ${intensity}/5`
                                            )
                                        )
                                    ),
                                    entry.triggers?.length > 0 && React.createElement('div', { className: 'mt-2' },
                                        React.createElement('p', { className: 'text-xs text-gray-600' },
                                            `Triggers: ${entry.triggers.slice(0, 2).join(', ')}${entry.triggers.length > 2 ? '...' : ''}`
                                        )
                                    )
                                );
                            })
                        ) : React.createElement('p', { className: 'text-gray-500 text-sm' }, 'No cravings tracked yet. Complete a craving assessment to start!')
                    )
                );
            };

            const renderCravingAnalytics = () => {
                const getCravingStats = () => {
                    if (cravingLog.length === 0) return null;
                    
                    const emotionCounts = {};
                    const foodCounts = {};
                    const triggerCounts = {};
                    const intensityAvg = cravingLog.reduce((sum, entry) => {
                        const intensity = parseInt(entry.intensity?.charAt(0)) || 0;
                        return sum + intensity;
                    }, 0) / cravingLog.length;
                    
                    cravingLog.forEach(entry => {
                        entry.emotions?.forEach(emotion => {
                            emotionCounts[emotion] = (emotionCounts[emotion] || 0) + 1;
                        });
                        
                        if (entry.food) {
                            foodCounts[entry.food] = (foodCounts[entry.food] || 0) + 1;
                        }
                        
                        entry.triggers?.forEach(trigger => {
                            triggerCounts[trigger] = (triggerCounts[trigger] || 0) + 1;
                        });
                    });
                    
                    return {
                        totalCravings: cravingLog.length,
                        avgIntensity: intensityAvg.toFixed(1),
                        topEmotion: Object.keys(emotionCounts).sort((a,b) => emotionCounts[b] - emotionCounts[a])[0],
                        topFood: Object.keys(foodCounts).sort((a,b) => foodCounts[b] - foodCounts[a])[0],
                        topTrigger: Object.keys(triggerCounts).sort((a,b) => triggerCounts[b] - triggerCounts[a])[0]
                    };
                };
                
                const stats = getCravingStats();
                
                return React.createElement('div', { className: 'px-4 pb-6 space-y-6' },
                    React.createElement('div', { className: 'text-center py-4' },
                        React.createElement(AlertCircle, { className: 'w-16 h-16 mx-auto text-purple-500 mb-4' })
                    ),

                    stats ? React.createElement('div', { className: 'space-y-6' },
                        React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                            React.createElement('div', { className: 'bg-purple-50 border border-purple-200 rounded-xl p-4 text-center' },
                                React.createElement('p', { className: 'text-2xl font-bold text-purple-800' }, stats.totalCravings),
                                React.createElement('p', { className: 'text-sm text-purple-600' }, 'Total Cravings')
                            ),
                            React.createElement('div', { className: 'bg-purple-50 border border-purple-200 rounded-xl p-4 text-center' },
                                React.createElement('p', { className: 'text-2xl font-bold text-purple-800' }, `${stats.avgIntensity}/5`),
                                React.createElement('p', { className: 'text-sm text-purple-600' }, 'Avg Intensity')
                            )
                        ),

                        React.createElement('div', { className: 'bg-white border border-gray-200 rounded-xl p-6' },
                            React.createElement('h3', { className: 'font-semibold text-gray-800 mb-4' }, 'Your Patterns:'),
                            React.createElement('div', { className: 'space-y-3 text-sm' },
                                stats.topEmotion && React.createElement('p', null, React.createElement('strong', null, 'Most common emotion: '), stats.topEmotion),
                                stats.topFood && React.createElement('p', null, React.createElement('strong', null, 'Most craved food: '), stats.topFood),
                                stats.topTrigger && React.createElement('p', null, React.createElement('strong', null, 'Top trigger: '), stats.topTrigger)
                            )
                        ),

                        React.createElement('div', { className: 'space-y-4' },
                            React.createElement('h3', { className: 'font-semibold text-gray-700' }, 'Recent Cravings:'),
                            React.createElement('div', { className: 'max-h-60 overflow-y-auto space-y-3' },
                                cravingLog.slice(-5).reverse().map((entry, index) => (
                                    React.createElement('div', { key: index, className: 'bg-gray-50 border border-gray-200 rounded-lg p-4' },
                                        React.createElement('div', { className: 'flex justify-between items-start mb-2' },
                                            React.createElement('span', { className: 'font-medium text-gray-800 text-sm' }, entry.food),
                                            React.createElement('span', { className: 'text-xs text-gray-500' },
                                                `${new Date(entry.timestamp).toLocaleDateString()} ${new Date(entry.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`
                                            )
                                        ),
                                        React.createElement('div', { className: 'text-xs text-gray-600' },
                                            React.createElement('p', null, React.createElement('strong', null, 'Emotions: '), entry.emotions?.join(', ') || 'None'),
                                            React.createElement('p', null, React.createElement('strong', null, 'Outcome: '), entry.outcome?.replace('_', ' '))
                                        )
                                    )
                                ))
                            )
                        )
                    ) : React.createElement('div', { className: 'bg-gray-50 border border-gray-200 rounded-xl p-6 text-center' },
                        React.createElement('p', { className: 'text-gray-600' },
                            'No craving data yet. Complete a few craving assessments to see your patterns!'
                        )
                    )
                );
            };

            // Main render
            return React.createElement('div', { className: 'max-w-md mx-auto bg-white min-h-screen relative' },
                renderHeader(),
                renderMenu(),
                
                React.createElement('div', { className: 'pb-safe' },
                    currentView === 'home' && renderHome(),
                    currentView === 'hungerCheck' && renderHungerCheck(),
                    currentView === 'wait' && renderWait(),
                    currentView === 'waitShort' && renderWaitShort(),
                    currentView === 'readyToEat' && renderReadyToEat(),
                    currentView === 'eating' && renderEating(),
                    currentView === 'eatingComplete' && renderEatingComplete(),
                    currentView === 'cravingCheck' && renderCravingCheck(),
                    currentView === 'cravingResult' && renderCravingResult(),
                    currentView === 'cravingTracking' && renderCravingTracking(),
                    currentView === 'cravingAnalytics' && renderCravingAnalytics()
                )
            );
        };

        ReactDOM.render(React.createElement(MindfulEatingCoach), document.getElementById('root'));
    </script>
</body>
</html>
